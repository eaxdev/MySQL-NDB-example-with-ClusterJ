# MAINTAINER Roman S.A. <eaxdev@ya.ru>

version: "3"

services:
  ndb_mgmd:
    image: mysql/mysql-cluster
    command: 'ndb_mgmd'
    ports:
      - "1186"
    volumes:
      - ./mysql-cluster.cnf:/etc/mysql-cluster.cnf
    networks:
      cluster:
        ipv4_address: 192.168.0.2

  ndb_data_node_1:
    image: mysql/mysql-cluster
    command: 'ndbd'
    depends_on:
      - ndb_mgmd
    networks:
      cluster:
        ipv4_address: 192.168.0.3

  ndb_data_node_2:
    image: mysql/mysql-cluster
    container_name: 'ndb2'
    command: 'ndbd'
    depends_on:
      - ndb_mgmd
    networks:
      cluster:
        ipv4_address: 192.168.0.4

  ndb_mysqld:
    image: mysql/mysql-cluster
    command: 'mysqld'
    ports:
      - "3306"
    environment:
      - MYSQL_DATABASE=NDB_DB
      - MYSQL_USER=sys
      - MYSQL_PASSWORD=qwerty
    depends_on:
      - ndb_mgmd
      - ndb_data_node_1
    networks:
      cluster:
        ipv4_address: 192.168.0.10

networks:
  cluster:
    ipam:
      driver: default
      config:
        - subnet: "192.168.0.0/16"